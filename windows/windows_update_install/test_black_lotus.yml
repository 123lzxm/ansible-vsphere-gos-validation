# Copyright 2024 VMware, Inc.
# SPDX-License-Identifier: BSD-2-Clause
---
- name: "Get VM boot info"
  include_tasks: ../../common/vm_get_boot_info.yml
- name: "Enable Secure boot"
  include_tasks: ../secureboot_enable_disable/change_secureboot_config.yml
  vars:
    change_secureboot: 'enable'
  when:
    - vm_secureboot_enabled is defined
    - not vm_secureboot_enabled | bool

#- name: "Apply DBX update according to KB5025885"
#  include_tasks: apply_dbx_update_kb5025885.yml

- name: "Update DB PCA2023"
  include_tasks: apply_db_update_pca2023_kb5037167.yml

- name: "Install the PCA2023-signed boot manager"
  include_tasks: install_pca2023_signed_bm_kb5037167.yml

- name: "Aplly dbx revocation of PCA2011"
  include_tasks: apply_dbx_update_kb5037167.yml